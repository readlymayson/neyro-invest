# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º T-Bank Sandbox —Å—á–µ—Ç–µ

## üìä –î–∞–Ω–Ω—ã–µ —Å—á–µ—Ç–∞

**Account ID:** `24fdd4b3-aba2-4410-ae91-d57a8190909b`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω  
**–°–æ–∑–¥–∞–Ω:** 22 –æ–∫—Ç—è–±—Ä—è 2025  
**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª:** 1,000,000 ‚ÇΩ  
**–†–µ–∂–∏–º:** Sandbox (–ø–µ—Å–æ—á–Ω–∏—Ü–∞)

---

## ‚úÖ –û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å

### –ë—É–¥–µ—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ—Ç ID –≤ –±—É–¥—É—â–µ–º?

**–î–ê!** –≠—Ç–æ—Ç —Å—á–µ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ **–Ω–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚úÖ ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config/test_config.yaml`
2. ‚úÖ –ë—Ä–æ–∫–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å–ª–∏ `account_id` —É–∫–∞–∑–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. ‚úÖ –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ `account_id: null` - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–æ–¥ –∏–∑ `tbank_broker.py`):

```python
async def _setup_sandbox_account(self, client):
    if not self.account_id:
        # –°–æ–∑–¥–∞–Ω–∏–µ –ù–û–í–û–ì–û —Å—á–µ—Ç–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ account_id –Ω–µ —É–∫–∞–∑–∞–Ω)
        response = await client.sandbox.open_sandbox_account()
        self.account_id = response.account_id
        logger.info(f"–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π sandbox —Å—á–µ—Ç: {self.account_id}")
        
        # –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        await client.sandbox.sandbox_pay_in(...)
    else:
        # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô —Å—á–µ—Ç
        logger.info(f"–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π sandbox —Å—á–µ—Ç: {self.account_id}")
```

---

## ‚è∞ –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞

**–í–∞–∂–Ω–æ!** –°—á–µ—Ç–∞ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ T-Bank —Ö—Ä–∞–Ω—è—Ç—Å—è **3 –º–µ—Å—è—Ü–∞** —Å –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:
- ‚úÖ –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ - —Å—á–µ—Ç –±—É–¥–µ—Ç –∂–∏—Ç—å
- ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ 3 –º–µ—Å—è—Ü–∞ - —Å—á–µ—Ç —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- üîÑ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ - –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `account_id: null` –≤ –∫–æ–Ω—Ñ–∏–≥–µ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É —Ö–æ—Ç—è –±—ã —Ä–∞–∑ –≤ –º–µ—Å—è—Ü –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—á–µ—Ç–∞.

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í–∞—à —Å—á–µ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ —Ñ–∞–π–ª–µ `config/test_config.yaml`:

```yaml
trading:
  broker_settings:
    tinkoff:
      token: ${TINKOFF_TOKEN}
      sandbox: true
      account_id: "24fdd4b3-aba2-4410-ae91-d57a8190909b"  # ‚Üê –í–∞—à —Å—á–µ—Ç!
```

### –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `token` | –ò–∑ .env | –í–∞—à API —Ç–æ–∫–µ–Ω T-Bank |
| `sandbox` | `true` | –†–µ–∂–∏–º –ø–µ—Å–æ—á–Ω–∏—Ü—ã (–Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏) |
| `account_id` | –í–∞—à ID | –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—á–µ—Ç (–Ω–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ) |

---

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç:

1. ‚úÖ –ü–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –≤–∞—à–µ–º—É —Å—á–µ—Ç—É `24fdd4b3-aba2-4410-ae91-d57a8190909b`
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏ –ø–æ–∑–∏—Ü–∏–∏
3. ‚úÖ –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—á–µ—Ç–∞
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—á–µ—Ç–∞:

```python
from src.trading.tbank_broker import TBankBroker
import asyncio
import os

async def check_account():
    broker = TBankBroker(
        token=os.getenv('TINKOFF_TOKEN'),
        sandbox=True,
        account_id="24fdd4b3-aba2-4410-ae91-d57a8190909b"
    )
    await broker.initialize()
    
    portfolio = await broker.get_portfolio()
    print(f"Account ID: {broker.account_id}")
    print(f"Balance: {portfolio['total_amount']} ‚ÇΩ")

asyncio.run(check_account())
```

---

## üîÑ –ï—Å–ª–∏ —Å—á–µ—Ç —É–¥–∞–ª–∏–ª—Å—è (—á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞)

### –ü—Ä–∏–∑–Ω–∞–∫–∏:
- –û—à–∏–±–∫–∞ "Account not found"
- –ü—É—Å—Ç–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –ø–µ—Ä–µ—Ä—ã–≤–∞

### –†–µ—à–µ–Ω–∏–µ (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞):

**–í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç**
```yaml
# –í config/test_config.yaml –∏–∑–º–µ–Ω–∏—Ç–µ:
account_id: null  # –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∫–æ–¥**
```python
# –ó–∞–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—ã–π –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
await broker.close_sandbox_account()  # –ï—Å–ª–∏ —Å—Ç–∞—Ä—ã–π –µ—â–µ –∂–∏–≤
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å account_id: null –≤ –∫–æ–Ω—Ñ–∏–≥–µ
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É - —Å–æ–∑–¥–∞—Å—Ç—Å—è –Ω–æ–≤—ã–π
```

---

## üí∞ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞

–ü–æ –¥–∞–Ω–Ω—ã–º –∏–∑ –≤–∞—à–µ–≥–æ —Ç–µ—Å—Ç–∞:

```
Account ID: 24fdd4b3-aba2-4410-ae91-d57a8190909b
–†–µ–∂–∏–º: sandbox
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: 1929
–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: 0.00 ‚ÇΩ (–≤ –∞–∫—Ü–∏—è—Ö)
–ü–æ–∑–∏—Ü–∏–π: 1 (–Ω–∞–ª–∏—á–Ω—ã–µ)
–ë–∞–ª–∞–Ω—Å: 1,000,000.00 ‚ÇΩ (–≤ —Ä—É–±–ª—è—Ö)
```

### –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:
- ‚úÖ –°—á–µ—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ 1 –º–ª–Ω —Ä—É–±–ª–µ–π –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏
- ‚úÖ –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π (–≤—Å–µ –≤ –Ω–∞–ª–∏—á–Ω—ã—Ö)
- ‚úÖ 1929 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏

---

## üìã –í–∞–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á–µ—Ç:
```cmd
python examples/tbank_sandbox_test.py
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é —Å —ç—Ç–∏–º —Å—á–µ—Ç–æ–º:
```cmd
python run.py --config config/test_config.yaml
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏:
```python
operations = await broker.get_operations()
for op in operations:
    print(f"{op['date']}: {op['type']} - {op['payment']} ‚ÇΩ")
```

---

## ‚úÖ –†–µ–∑—é–º–µ

### –í–∞—à –≤–æ–ø—Ä–æ—Å: "–ë—É–¥–µ—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –±—Ä–æ–∫–µ—Ä –ø–æ —ç—Ç–æ–º—É ID –≤ –±—É–¥—É—â–µ–º?"

**–û–¢–í–ï–¢: –î–ê! ‚úÖ**

- ‚úÖ ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç —Å—á–µ—Ç
- ‚úÖ –ù–æ–≤—ã–µ —Å—á–µ—Ç–∞ **–ù–ï –ë–£–î–£–¢** —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –±–∞–ª–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚è∞ –°—á–µ—Ç –∂–∏–≤–µ—Ç 3 –º–µ—Å—è—Ü–∞ (–ø—Ä–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ - –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è T-Bank Sandbox:** https://developer.tbank.ru/invest/intro/developer/sandbox
- **–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [TBANK_SANDBOX_SETUP.md](TBANK_SANDBOX_SETUP.md)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** [../config/test_config.yaml](../config/test_config.yaml)

---

*–°–æ–∑–¥–∞–Ω–æ: 22 –æ–∫—Ç—è–±—Ä—è 2025*  
*ID —Å—á–µ—Ç–∞: 24fdd4b3-aba2-4410-ae91-d57a8190909b*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω*

