# Добавление reasoning (причины) к торговым сигналам

## Обзор изменений

В систему нейросетевых инвестиций добавлена функциональность генерации кратких сводок (reasoning) для каждого торгового сигнала. Теперь каждый сигнал содержит объяснение причины принятого решения.

## Измененные компоненты

### 1. TradingSignal класс
- **Файл**: `src/trading/trading_engine.py`
- **Изменение**: Добавлено поле `reasoning` для хранения причины решения
- **Параметры**: 
  - `reasoning: str = ""` - краткая сводка причины решения

### 2. Создание сигналов
- **Файл**: `src/trading/trading_engine.py`
- **Метод**: `_create_trading_signal()`
- **Изменение**: Извлечение поля `reasoning` из предсказаний моделей

### 3. Нейронные сети

#### XGBoostNetwork
- **Файл**: `src/neural_networks/xgboost_network.py`
- **Добавлен метод**: `_generate_reasoning()`
- **Функциональность**: Генерация reasoning на основе:
  - Типа сигнала (BUY/SELL/HOLD)
  - Уровня уверенности
  - Вероятностей классов
  - Новостного фона

#### DeepSeekNetwork
- **Файл**: `src/neural_networks/deepseek_network.py`
- **Статус**: Уже содержал поле `reasoning` в предсказаниях
- **Функциональность**: Использует AI-анализ для генерации reasoning

#### SimpleSignalGenerator
- **Файл**: `src/neural_networks/simple_signal_generator.py`
- **Добавлен метод**: `_generate_simple_reasoning()`
- **Функциональность**: Генерация простого reasoning для тестовых сигналов

### 4. Экспорт данных
- **Файл**: `src/core/investment_system.py`
- **Метод**: `_export_signals_data()`
- **Изменение**: Включение поля `reasoning` в JSON экспорт

### 5. Веб API
- **Файл**: `src/gui/web_app.py`
- **Статус**: Автоматически поддерживает новое поле через JSON загрузку

## Формат reasoning

### XGBoost reasoning
Пример: "Рекомендация покупки SBER. высокая уверенность. вероятность роста 75%. позитивные новости."

Компоненты:
- Основная рекомендация
- Уровень уверенности (высокая/средняя/низкая)
- Анализ вероятностей
- Новостной фон

### DeepSeek reasoning
Пример: "Анализ показывает восходящий тренд с поддержкой на уровне 245. Технические индикаторы указывают на продолжение роста. Новости положительные."

Компоненты:
- Технический анализ
- Уровни поддержки/сопротивления
- Паттерны
- Новостной анализ

### SimpleSignalGenerator reasoning
Пример: "Случайная рекомендация покупки SBER. высокая случайная уверенность. основано на случайной генерации для тестирования."

## JSON формат сигналов

```json
{
  "time": "12:30:15",
  "symbol": "SBER",
  "signal": "BUY",
  "confidence": 0.85,
  "action": "Сигнал: BUY",
  "price": 250.50,
  "strength": 0.7,
  "source": "xgboost_enhanced",
  "reasoning": "Рекомендация покупки SBER. высокая уверенность. вероятность роста 75%. позитивные новости."
}
```

## Преимущества

1. **Прозрачность**: Пользователи понимают причины торговых решений
2. **Отладка**: Легче анализировать работу моделей
3. **Обучение**: Помогает улучшать алгоритмы
4. **Доверие**: Повышает доверие к системе
5. **Анализ**: Возможность анализа качества reasoning

## Совместимость

- Все существующие API остаются совместимыми
- Новое поле `reasoning` является опциональным
- Старые сигналы без reasoning будут иметь пустое поле
- Веб-интерфейс автоматически отображает reasoning при его наличии

## Тестирование

Функциональность протестирована на:
- ✅ Создание TradingSignal с reasoning
- ✅ Генерация reasoning в SimpleSignalGenerator
- ✅ Экспорт в JSON с reasoning
- ✅ Совместимость с существующим API
