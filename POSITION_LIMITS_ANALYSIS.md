# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–∏–º–∏—Ç–∞–º–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω –ª–∏–º–∏—Ç 10% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç –ø–æ—á—Ç–∏ 50% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞.

## üßê –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤ –≤ —Ç–æ—Ä–≥–æ–≤–æ–º –¥–≤–∏–∂–∫–µ**
- –í `TradingEngine` –Ω–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∞ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–∫ 10% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∞, –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç –ª–∏ —ç—Ç–æ –ª–∏–º–∏—Ç –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏

### 2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω**
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∑–∏—Ü–∏–π
- –ë–µ–∑ —Ü–µ–Ω –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏**
```python
async def _check_position_size_limit(self, symbol: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
    
    Args:
        symbol: –¢–∏–∫–µ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        
    Returns:
        True –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
    """
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–ø–∏—Ç–∞–ª–∞
    portfolio_value = await self.portfolio_manager.get_portfolio_value()
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
    current_price = await self._get_current_price(symbol)
    
    # –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
    position_value = portfolio_value * self.position_size
    new_quantity = position_value / current_price
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
    existing_position = await self.portfolio_manager.get_position(symbol)
    if existing_position:
        # –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
        total_quantity = existing_position.quantity + new_quantity
        total_value = total_quantity * current_price
        total_weight = (total_value / portfolio_value) * 100
    else:
        # –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
        total_weight = (position_value / portfolio_value) * 100
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (10% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    max_weight = self.position_size * 100
    
    if total_weight > max_weight:
        logger.warning(f"‚ùå {symbol}: –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ {total_weight:.1f}% –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç {max_weight:.1f}%")
        return False
    
    logger.info(f"‚úÖ {symbol}: –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ {total_weight:.1f}% –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ {max_weight:.1f}%")
    return True
```

### 2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ç–æ—Ä–≥–æ–≤—ã–π –¥–≤–∏–∂–æ–∫**
```python
async def _can_open_position(self, symbol: str, signal: str) -> bool:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
    if signal == 'BUY':
        if not await self._check_position_size_limit(symbol):
            return False
    
    return True
```

### 3. **–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω**
```python
async def _get_current_price(self, symbol: str) -> float:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    """
    if not self.data_provider:
        logger.warning(f"‚ùå {symbol}: –ü—Ä–æ–≤–∞–π–¥–µ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        return 0.0
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    market_data = await self.data_provider.get_latest_data()
    
    if 'historical' in market_data and symbol in market_data['historical']:
        symbol_data = market_data['historical'][symbol]
        if not symbol_data.empty and 'Close' in symbol_data.columns:
            current_price = symbol_data['Close'].iloc[-1]
            return float(current_price)
    
    return 0.0
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
1. **–°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞** - –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è —É–∂–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10%, —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–æ–∫—É–ø–∫—É
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π** - —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - —Å–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

### ‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ü–µ–Ω** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω
2. **–¢–æ–ª—å–∫–æ –¥–ª—è BUY —Å–∏–≥–Ω–∞–ª–æ–≤** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ SELL —Å–∏–≥–Ω–∞–ª–∞–º (—á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `config/main.yaml` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ª–∏–º–∏—Ç—ã:
```yaml
trading:
  position_size: 0.1  # 10% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é
  max_positions: 10    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤**
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–µ—Å–∞ –ø–æ–∑–∏—Ü–∏–π –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤**
- –î–ª—è –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞: `position_size: 0.05` (5%)
- –î–ª—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞: `position_size: 0.15` (15%)

### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±—â–µ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–π –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∏—Å–∫–æ–≤** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ **–°–æ–±–ª—é–¥–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–Ω—ã–º –ª–∏–º–∏—Ç–∞–º
- ‚úÖ **–ó–∞—â–∏—Ç—É –∫–∞–ø–∏—Ç–∞–ª–∞** - —Å–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–µ—Ä—å –æ—Ç –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–∑–∏—Ü–∏–π! üéâ
