<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neyro-Invest - –ù–µ–π—Ä–æ—Å–µ—Ç–µ–≤–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1>üöÄ Neyro-Invest</h1>
                </div>
                <div class="status-indicator">
                    <div class="status-badge" :class="systemRunning ? 'status-active' : 'status-inactive'">
                        <span class="status-dot"></span>
                        {{ systemRunning ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' }}
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button 
                v-for="tab in tabs" 
                :key="tab.id"
                @click="switchTab(tab.id)"
                :class="['tab-btn', currentTab === tab.id ? 'active' : '']">
                {{ tab.icon }} {{ tab.name }}
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div v-show="currentTab === 'dashboard'" class="tab-content">
                <h2>üìä –î–∞—à–±–æ—Ä–¥</h2>
                
                <!-- T-Bank Connection Status -->
                <div class="connection-status" v-if="!tbankConnected">
                    <div class="connection-card">
                        <div class="connection-header">
                            <h3>üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ T-Bank</h3>
                            <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ T-Bank API</p>
                        </div>
                        <div class="connection-actions">
                            <button @click="connectToTbank" class="btn btn-primary" :disabled="connecting">
                                {{ connecting ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...' : '–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ T-Bank' }}
                            </button>
                        </div>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">üí∞ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Ä—Ç—Ñ–µ–ª—è</div>
                        <div class="card-value">{{ formatCurrency(portfolio.total_value) }}</div>
                        <div class="card-change" :class="portfolio.total_pnl >= 0 ? 'positive' : 'negative'">
                            {{ portfolio.total_pnl >= 0 ? '‚ñ≤' : '‚ñº' }} {{ formatCurrency(portfolio.total_pnl) }} 
                            ({{ (portfolio.total_pnl_percent || 0).toFixed(2) }}%)
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">üíµ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</div>
                        <div class="card-value">{{ formatCurrency(portfolio.cash_balance) }}</div>
                        <div class="card-info">
                            {{ ((portfolio.cash_balance / (portfolio.total_value || 1)) * 100).toFixed(1) }}% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
                        <div class="card-value">{{ formatCurrency(portfolio.invested_value) }}</div>
                        <div class="card-info">
                            {{ ((portfolio.invested_value / (portfolio.total_value || 1)) * 100).toFixed(1) }}% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
                        </div>
                    </div>

                <div class="card">
                    <div class="card-header">üì¶ –ü–æ–∑–∏—Ü–∏–π –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ</div>
                    <div class="card-value">{{ portfolio.positions_count }}</div>
                    <div class="card-info">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π</div>
                </div>
                
                <div class="card" v-if="portfolio.mode">
                    <div class="card-header">üìä –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="card-value" :class="getModeClass(portfolio.mode)">
                        {{ getModeText(portfolio.mode) }}
                    </div>
                    <div class="card-info">–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>–ì—Ä–∞—Ñ–∏–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è</h3>
                        <canvas id="portfolioChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–æ–≤</h3>
                        <canvas id="assetsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Trading Tab -->
            <div v-show="currentTab === 'trading'" class="tab-content">
                <h2>‚ö° –¢–æ—Ä–≥–æ–≤–ª—è</h2>
                
                <div class="control-panel">
                    <button 
                        @click="startSystem" 
                        :disabled="systemRunning"
                        class="btn btn-success">
                        ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
                    </button>
                    <button 
                        @click="stopSystem" 
                        :disabled="!systemRunning"
                        class="btn btn-danger">
                        ‚è∏Ô∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
                    </button>
                </div>

                <div class="signals-section">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                    <div class="table-container">
                        <table class="signals-table">
                            <thead>
                                <tr>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–¢–∏–∫–µ—Ä</th>
                                    <th>–°–∏–≥–Ω–∞–ª</th>
                                    <th>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</th>
                                    <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="signal in signals" :key="signal.timestamp + signal.symbol">
                                    <td>{{ formatTime(signal.timestamp) }}</td>
                                    <td><strong>{{ signal.symbol }}</strong></td>
                                    <td>
                                        <span :class="['signal-badge', 'signal-' + signal.signal.toLowerCase()]">
                                            {{ signal.signal }}
                                        </span>
                                    </td>
                                    <td>{{ ((signal.confidence || 0) * 100).toFixed(1) }}%</td>
                                    <td>{{ signal.source }}</td>
                                    <td>
                                        <span :class="['status-badge-small', signal.executed ? 'executed' : 'pending']">
                                            {{ signal.executed ? '‚úì –ò—Å–ø–æ–ª–Ω–µ–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç' }}
                                        </span>
                                    </td>
                                </tr>
                                <tr v-if="signals.length === 0">
                                    <td colspan="6" class="empty-state">–°–∏–≥–Ω–∞–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Portfolio Tab -->
            <div v-show="currentTab === 'portfolio'" class="tab-content">
                <h2>üíº –ü–æ—Ä—Ç—Ñ–µ–ª—å</h2>
                
                <div class="portfolio-summary">
                    <div class="summary-item">
                        <span>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                        <strong>{{ formatCurrency(portfolio.total_value) }}</strong>
                    </div>
                    <div class="summary-item">
                        <span>P&L:</span>
                        <strong :class="portfolio.total_pnl >= 0 ? 'positive' : 'negative'">
                            {{ formatCurrency(portfolio.total_pnl) }} ({{ (portfolio.total_pnl_percent || 0).toFixed(2) }}%)
                        </strong>
                    </div>
                    <div class="summary-item">
                        <span>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</span>
                        <strong>{{ formatTime(portfolio.last_update) }}</strong>
                    </div>
                </div>

                <div class="table-container">
                    <table class="portfolio-table">
                        <thead>
                            <tr>
                                <th>–¢–∏–∫–µ—Ä</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</th>
                                <th>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</th>
                                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                <th>P&L</th>
                                <th>% –æ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="position in portfolio.positions" :key="position.symbol">
                                <td><strong>{{ position.symbol }}</strong></td>
                                <td>{{ position.name || '-' }}</td>
                                <td>{{ position.quantity }}</td>
                                <td>{{ formatCurrency(position.avg_price) }}</td>
                                <td>{{ formatCurrency(position.current_price) }}</td>
                                <td>{{ formatCurrency(position.value) }}</td>
                                <td :class="position.pnl >= 0 ? 'positive' : 'negative'">
                                    {{ formatCurrency(position.pnl) }}
                                    <br>
                                    <small>({{ (position.pnl_percent || 0).toFixed(2) }}%)</small>
                                </td>
                                <td>{{ (position.weight_percent || 0).toFixed(2) }}%</td>
                            </tr>
                            <tr v-if="!portfolio.positions || portfolio.positions.length === 0">
                                <td colspan="8" class="empty-state">–ü–æ–∑–∏—Ü–∏–π –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ –Ω–µ—Ç</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Configuration Tab -->
            <div v-show="currentTab === 'config'" class="tab-content">
                <h2>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
                
                <div class="config-section">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ T-Bank API</h3>
                    <div class="form-group">
                        <label>–¢–æ–∫–µ–Ω T-Bank:</label>
                        <input 
                            type="password" 
                            v-model="config.tbank_token" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω..."
                            class="input">
                        <button @click="showTokenHelp" class="btn-link">‚ÑπÔ∏è –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω?</button>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" v-model="config.sandbox">
                            –†–µ–∂–∏–º –ø–µ—Å–æ—á–Ω–∏—Ü—ã (Sandbox)
                        </label>
                        <p class="help-text">
                            –í —Ä–µ–∂–∏–º–µ –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        </p>
                    </div>

                    <div class="form-group">
                        <button @click="checkTbankConnection" class="btn btn-primary">
                            üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                        </button>
                        <button @click="getTbankBalance" class="btn btn-secondary">
                            üí∞ –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —Å–æ —Å—á–µ—Ç–∞
                        </button>
                    </div>

                    <div v-if="connectionStatus" class="alert" :class="connectionStatus.success ? 'alert-success' : 'alert-error'">
                        <strong>{{ connectionStatus.success ? '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è' }}</strong>
                        <div v-if="connectionStatus.success">
                            <p>–†–µ–∂–∏–º: {{ connectionStatus.mode }}</p>
                            <p>ID —Å—á–µ—Ç–∞: {{ connectionStatus.account_id }}</p>
                            <p>–ë–∞–ª–∞–Ω—Å: {{ formatCurrency(connectionStatus.balance) }}</p>
                            <p>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {{ connectionStatus.instruments }}</p>
                        </div>
                        <div v-else>
                            <p>{{ connectionStatus.error }}</p>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è</h3>
                    <div class="form-group">
                        <label>–ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª (‚ÇΩ):</label>
                        <input 
                            type="number" 
                            v-model.number="config.initial_capital" 
                            min="0"
                            step="10000"
                            class="input">
                    </div>

                    <div class="form-group">
                        <label>–ü–æ—Ä–æ–≥ —Å–∏–≥–Ω–∞–ª–∞ (0-1):</label>
                        <input 
                            type="number" 
                            v-model.number="config.signal_threshold" 
                            min="0"
                            max="1"
                            step="0.05"
                            class="input">
                        <p class="help-text">
                            –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
                        </p>
                    </div>

                    <div class="form-group">
                        <label>–¢–æ—Ä–≥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</label>
                        <textarea 
                            v-model="config.symbols_text" 
                            rows="5"
                            placeholder="SBER, GAZP, LKOH, YNDX..."
                            class="input"></textarea>
                        <p class="help-text">
                            –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <button @click="saveConfig" class="btn btn-success">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                    </button>
                    <button @click="loadConfig" class="btn btn-secondary">
                        üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                    </button>
                </div>
            </div>

            <!-- Logs Tab -->
            <div v-show="currentTab === 'logs'" class="tab-content">
                <h2>üìù –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                
                <div class="logs-controls">
                    <button @click="loadLogs" class="btn btn-secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button @click="clearLogsDisplay" class="btn btn-secondary">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω</button>
                    <label>
                        <input type="checkbox" v-model="autoRefreshLogs">
                        –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    </label>
                </div>

                <div class="logs-container">
                    <pre v-if="logs.length > 0">{{ logs.join('') }}</pre>
                    <div v-else class="empty-state">–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>¬© 2025 Neyro-Invest | –í–µ—Ä—Å–∏—è 2.0.0 | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ formatTime(lastUpdate) }}</p>
        </footer>

        <!-- Modal for token help -->
        <div v-if="showTokenModal" class="modal" @click="showTokenModal = false">
            <div class="modal-content" @click.stop>
                <h3>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω T-Bank?</h3>
                <ol class="help-list">
                    <li>–ó–∞–π–¥–∏—Ç–µ –≤ <strong>T-Bank Invest</strong> (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤–µ–±-–≤–µ—Ä—Å–∏—è)</li>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API –¥–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</strong></li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω"</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ —Ç–æ—Ä–≥–æ–≤–ª—é)</li>
                    <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ –≤—ã—à–µ</li>
                </ol>
                <p class="warning">‚ö†Ô∏è –•—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! –ù–∏–∫–æ–º—É –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ!</p>
                <button @click="showTokenModal = false" class="btn btn-primary">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>

